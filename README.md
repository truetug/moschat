# Задание
Разработать прототип чат-бота, 
который умеет отвечать на 2-3 команды, 
которые возвращают данные из внешнего источника (погода, курс и т.п.).

## Технические требования
Клиент может быть реализован на любых технологиях, позволяющих 
продемонстрировать работу.

Сервер: Python, FastAPI, Centrifugo, остальное на выбор.

## Возможности клиента и сервера
* Авторизация по логину/паролю. Можно использовать предопределенный список 
пользователей;
* В клиенте можно увидеть список команд и отправить выбранную команду;
* Получить ответ;
* При обрыве соединения и последующем восстановлении – сессия сохраняется;
* История сообщений сохраняется;
* Если команда не успела исполнится, а пользователь ушел – отвечать только по 
возвращению онлайн. 
 
## Результат решения
* Описание архитектуры;
* Код клиента;
* Код сервера;
* Краткая инструкция по использованию;
* Ограничения в реализованной системе;
* План поэтапного развития и расширения системы.

---

## Описание архитектуры
Для экономии времени я реализовал всё в одном репозитории и одном FastAPI-сервисе.

Фронт: vanila js

Бэк: FastAPI

Брокер: Centrifugo + Redis

База: SQLite3

## Порядок работы
* Фронт запрашивает у бэка начальную конфигурацию
* Пользователю высылается приветственное сообщение
* Пользователь может отправить сообщение в чат
* Пользователю в чат через Центрифуго попадает сообщение, которое он отправил (Все сообщения проходят через API бэкенда, так что если оно появилось в окне чата, то оно прошло через бэк, где оно сохраняется в истории)
* Если сообщение команда (начинается с ` \ `), то оно передаётся в функцию, выполняющую матчинг по названиям зарегистрированным в `app.settings.services`
* Если нашлась подходящая команда, она включена и у пользователя есть права для её запуска, выполняем её
* Ответ от команды сохраняется в истории и отправляется пользователю через Центрифуго
* Авторизация вызывает переключение на другой канал, очистку окна чата и показ последних 10 сообщений из истории 

## Краткая инструкция по использованию

    git clone https://github.com/truetug/moschat
    cd moschat
    docker compose up -d

Интерфейс: http://localhost:8080
 

## Ограничения в реализованной системе
* Не работает с текстовыми запросами, только с коммандами
* Не поддерживает регистрацию, в базе лежит один пользователь для теста
* Возможно не совсем по заданию работают некоторые кейсы связанные с уходом пользователя без ответа

## План поэтапного развития и расширения системы
* Написать API, которое регистрирует внешние Сервисы
* Дописать регистрацию
* Улучшить логику работы в присутствие пользователя в канале
* Абстрагировать API от веб чата, так чтобы можно было подключить любой чат-движок